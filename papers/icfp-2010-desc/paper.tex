\documentclass[preprint, authoryear, onecolumn]{sigplanconf}

\usepackage{amsmath}
\usepackage{verbatim}
\usepackage{pig}

\include{macros}

%% Structure
\newenvironment{structure}{\footnotesize\verbatim}{\endverbatim}
%\newenvironment{structure}{\comment}{\endcomment}


\begin{document}

\ColourEpigram

%\conferenceinfo{WXYZ '05}{date, City.} 
%\copyrightyear{2005} 
%\copyrightdata{[to be supplied]} 

%\titlebanner{banner above paper title}        % These are ignored unless
%\preprintfooter{short description of paper}   % 'preprint' option specified.



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Title
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\title{The Gentle Art of Levitation}
% Or something mentionning levitation. Feel free to change. 
% \subtitle{Subtitle Text, if any}


%% Alphabetical ordering.
\authorinfo{James Chapman}
           {Institute of Cybernetics, Tallinn University of Technology}
           {james@cs.ioc.ee}
\authorinfo{Pierre-\'{E}variste Dagand \\ Conor McBride}
           {University of Strathclyde}
           {\{dagand,conor\}@cis.strath.ac.uk}
\authorinfo{Peter Morris}
           {University of Nottingham}
           {pwm@cs.nott.ac.uk}


\maketitle


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Abstract
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\begin{abstract}
This is the text of the abstract.
\end{abstract}

%\category{CR-number}{subcategory}{third-level}

%\terms
%term1, term2

%\keywords
%keyword1, keyword2





%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Introduction
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Introduction}

The text of the paper begins here. \cite{morris:spf}

ACM bullet points, we offer:
\begin{itemize}
\item a closed presentation of data-types (no generativity requires)
  subsuming standard inductive families (some popular extensions
  excluded for now)
\item descriptions of data-types are first-class (indeed,
  self-encoded)
\item ``generic programming is just programming''
\item first serious attempt to design a language for generic
  programming, except possibly Lisp
\end{itemize}

\begin{structure}
<- presentation of the Core theory
    -> judgemental equality (extensional (a la OTT?))
    /> not Epigram specific 
        <- having OTT just buys you more stuffs
\end{structure}



%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% The Type Theory
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\input{paper_type_theory}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% A Universe of simple data-types
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\input{paper_desc}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Levitating the universe of descriptions
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\input{paper_desc_levitation}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Indexing descriptions
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{From Desc to IDesc}

\begin{structure}
<- Labelling the \DId
\end{structure}

%% \[
%% \stk{
%% \data \IDesc{} : \PI{\V{I}}{\Set}{\Set} \where \\
%% \;\;\begin{array}{@{}l@{\::\:}l@{\quad}l}
%%     \DVar           & I \To \IDesc{I}                                   \\
%%     \DUnit          & \IDesc{I}                                         \\
%%     \DProd{}{}      & \PI{\V{D}, \V{D'}}{\IDesc{I}} \IDesc{I}           \\
%%     \DSigma         & \PI{\V{S}}{\Set} \PIS{S \To \IDesc{I}} \IDesc{I}  \\
%%     \DPi            & \PI{\V{S}}{\Set} \PIS{S \To \IDesc{I}} \IDesc{I} 
%% \end{array}
%% }
%% \]


%% \[\stk{
%% \idescop{\_\:}{}{} : \PI{\V{I}}{\Set} \IDesc{I} \To \Set \To \Set          \\
%% \begin{array}{@{}l@{\:=\:\:}ll}
%% \idescop{\DVar{i}}{I}{P}      &  P~i                                         \\
%% \idescop{\DUnit}{I}{P}        &  \Unit                                       \\
%% \idescop{\DProd{D}{D'}}{I}{P} &  \TIMES{\idescop{D}{I}{P}}{\idescop{D'}{I}{P}}       \\
%% \idescop{\DSigma{S}{D}}{I}{P} &  \SIGMA{\V{s}}{S} \idescop{D\: s}{I}{P}                \\
%% \idescop{\DPi{S}{D}}{I}{P}    &  \PI{\V{s}}{S} \idescop{D\: s}{I}{P}            
%% \end{array}
%% }\]

\begin{structure}
<- I -> IDesc I describes an inductive family
\end{structure}

\begin{structure}
<- Replace DUnit by const
\end{structure}


\[
\stk{
\data \IDesc{} : \PI{\V{I}}{\Set} \Set \where \\
\;\;\begin{array}{@{}l@{\::\:}l@{\quad}l}
    \DVar{}         & I \To \IDesc{I}                                   \\
    \DConst{}       & \Set \To \IDesc{I}                                \\
    \DProd{}{}      & \PI{\V{D}, \V{D'}}{\IDesc{I}} \IDesc{I}           \\
    \DSigma         & \PI{\V{S}}{\Set} \PIS{S \To \IDesc{I}} \IDesc{I}  \\
    \DPi            & \PI{\V{S}}{\Set} \PIS{S \To \IDesc{I}} \IDesc{I} 
\end{array}
}
\]


\[\stk{
\idescop{\_\:}{}{} : \PI{\V{I}}{\Set} \IDesc{I} \To \Set \To \Set                  \\
\begin{array}{@{}l@{\:=\:\:}ll}
\idescop{\DVar{i}}{I}{P}      &  P~i                                                 \\
\idescop{\DConst{X}}{I}{P}    &  X                                                   \\
\idescop{\DProd{D}{D'}}{I}{P} &  \TIMES{\idescop{D}{I}{P}}{\idescop{D'}{I}{P}}       \\
\idescop{\DSigma{S}{D}}{I}{P} &  \SIGMA{\V{s}}{S} \idescop{D\: s}{I}{P}                    \\
\idescop{\DPi{S}{D}}{I}{P}    &  \PI{\V{s}}{S} \idescop{D\: s}{I}{P}            
\end{array}
}\]

\begin{structure}
<- Examples
    -> Point out that our old examples fit in 1 -> IDesc 1
    -> Levitate: no big deal
\end{structure}

\[\stk{
\IDescD : \PI{\V{I}}{\Set} \IDesc{\Unit} \\
\begin{array}{ll}
\IDescD~I \mapsto \DSigma{}{} & (\EnumT [ \DVar{},
\DConst{},
                                                                                    \DProd{}{},
                                          \DSigma{}{}, 
                                          \DPi{}{} ]) \\
                              & \left[\begin{array}{l}
                                      \DConst{I}                  \\
                                      \DConst{\Set}               \\
                                      \DProd{\DVar{\Void}}{\DVar{\Void}}  \\
                                      \DSigma{\Set}{(\LAM{S} \DPi{S}{(\LAM{\_} \DVar{\Void})})} \\
                                      \DSigma{\Set}{(\LAM{S} \DPi{S}{(\LAM{\_} \DVar{\Void})})}
                                   \end{array}
                             \right]
\end{array}
}\]

\begin{structure}
    -> untyped lambda terms
        /> What is Fin??
\end{structure}

\[\stk{
\LambdaTD : \Nat \To \IDesc{\Nat} \\
\begin{array}{@{}ll}
\LambdaTD\: n = \DSigma{}{} & (\EnumT [ \LambdaTVar, \LambdaTApp, \LambdaTLam ]) \\
                            & \left[\begin{array}{l}
                                  \DConst{\Fin{n}} \\
                                  \DProd{\DVar{n}}{\DVar{n}} \\
                                  \DVar{(\NatSuc{n})}
                              \end{array}\right]
\end{array}
}\]

\subsection{Constrained constructors, bis}

\[\stk{
\FinD : \Nat \To \IDesc{\Nat} \\
\begin{array}{@{}ll}
\FinD\: n = \DSigma{}{} & (\EnumT [ \FinZero , \FinSuc{} ]) \\
                        & \left[
                          \begin{array}{l}
                            \DSigma{\Nat}{\LAM{m} \DConst{(n \PropEq \NatSuc{m})}} \\
                            \DSigma{\Nat}{\LAM{m} \DProd{\DVar{m}}{\DConst{(n \PropEq \NatSuc{m})}}}
                          \end{array}
                          \right]
\end{array}
}\]

\begin{structure}
<- Presbyterianism, Episcopalism, Catholicism
<- Brady-optimization: source-to-source
    -> Anglo-catholicism
\end{structure}

\[\stk{
\FinD : \Nat \To \IDesc{\Nat} \\
\begin{array}{@{}llll}
\FinD\: 0            & = & \multicolumn{2}{l}{\DSigma{\Void}{\Void} } \\
\FinD\: (\NatSuc{n}) & = & \DSigma{}{} & (\EnumT [ \FinZero , \FinSuc{} ]) \\
                     &   &             & \left[
                                         \begin{array}{l}
                                         \DConst{\Unit} \\
                                         \DVar{n}
                                         \end{array}
                                         \right]
\end{array}
}\]

 
%% \[
%% \stk{
%% \data \IDesc{} : \PI{\V{I}}{\Set} \Set \where \\
%% \;\;\begin{array}{@{}l@{\::\:}l@{\quad}l}
%%     \DConst{}       & \Set \To \IDesc{I}                                \\
%%     \DVar{}         & I \To \IDesc{I}                                   \\
%%     \DPrf{}         & \Prop \To \IDesc{I}                               \\
%%     \DProd{}{}      & \PI{\V{D}, \V{D'}}{\IDesc{I}} \IDesc{I}           \\
%%     \DSigma         & \PI{\V{S}}{\Set} \PIS{S \To \IDesc{I}} \IDesc{I}  \\
%%     \DPi            & \PI{\V{S}}{\Set} \PIS{S \To \IDesc{I}} \IDesc{I} 
%% \end{array}
%% }
%% \]


%% \[\stk{
%% \idescop{\_\:}{}{} : \PI{\V{I}}{\Set} \IDesc{I} \To \Set \To \Set                \\
%% \begin{array}{@{}l@{\:=\:\:}ll}
%% \idescop{\DConst{X}}{I}{P}    &  X                                                   \\
%% \idescop{\DVar{i}}{I}{P}      &  P~i                                                 \\
%% \idescop{\DPrf{q}}{I}{P}      &  \prf{q}                                             \\
%% \idescop{\DProd{D}{D'}}{I}{P} &  \TIMES{\idescop{D}{I}{P}}{\idescop{D'}{I}{P}}       \\
%% \idescop{\DSigma{S}{D}}{I}{P} &  \SIGMA{\V{s}}{S} \idescop{D s}{I}{P}                \\
%% \idescop{\DPi{S}{D}}{I}{P}    &  \PI{\V{s}}{S} \idescop{D s}{I}{P}            
%% \end{array}
%% }\]



\[\stk{
\LambdaTFreeD : \Nat \To \IDesc{\Nat} \\
\begin{array}{@{}ll}
\LambdaTFreeD\: n = \DSigma{}{} & (\EnumT [ \LambdaTApp, \LambdaTLam ]) \\
                                & \left[\begin{array}{l}
                                  \DProd{\DVar{n}}{\DVar{n}} \\
                                  \DVar{(\NatSuc{n})}
                                  \end{array}\right]
\end{array}
}\]

\[\stk{
\LambdaTD : \Nat \To \IDesc{\Nat} \\
\LambdaTD\: \mapsto \FreeMonad{[\LambdaTFreeD]}{\Fin{}}
}\]


\[\stk{
\IDescFreeD : \PI{\V{I}}{\Set} \IDesc{\Unit} \\
\begin{array}{@{}ll}
\IDescFreeD~I \mapsto \DSigma{}{} & (\EnumT [ \DConst{},
                                              \DProd{}{},
                                              \DSigma{}{}, 
                                              \DPi{}{} ]) \\
                                  & \left[\begin{array}{l}
                                        \DConst{\Set}               \\
                                        \DProd{\DVar{\Void}}{\DVar{\Void}}  \\
                                        \DSigma{\Set}{(\LAM{S} \DPi{S}{(\LAM{\_} \DVar{\Void})})} \\
                                        \DSigma{\Set}{(\LAM{S} \DPi{S}{(\LAM{\_} \DVar{\Void})})}
                                    \end{array}\right]
\end{array}
}\]

\[\stk{
\IDescD : \PI{\V{I}}{\Set} \IDesc{\Unit} \\
\IDescD\: I \mapsto \FreeMonad{[\IDescFreeD]}{I}\: I
}\]

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Desc
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{A simple universe of descriptions}

\begin{structure}
<- a universe of simple inductive types
    -> nil, arg, ind, hind
<- levitation
\end{structure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% IDesc
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Indexing descriptions}


\begin{structure}
<- enumerations
<- indexing
    -> nil, arg, ind, hind
    -> var, Pi, Sigma, :-, x, Sigma_f
<- closure under \box and \diamond
<- Brady optimization as desc transformation
<- ``standard'' descriptions start with Sigma_f
    -> SIDesc : I -> (E : EnumU) -> Branches(E , \ e -> IDesc I )
<- ``standard'' descriptions closed under the free monad constructions
<- IDesc is just such a free monad
\end{structure}

%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Discussion (?)
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Discussion}

\begin{structure}
<- universe stratification
    -> how would IDesc play with it?
\end{structure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Conclusion
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

\section{Conclusion}

\begin{structure}
\end{structure}


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Appendices
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \appendix
% \section{Appendix Title}

% This is the text of the appendix, if you need one.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Acknowledgments
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%

% \acks

% Acknowledgments, if needed.


%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%
%% Bibliography
%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%%


\bibliography{paper}
\bibliographystyle{abbrvnat}

% The bibliography should be embedded for final submission.
%\begin{thebibliography}{}
%\softraggedright
%\end{thebibliography}

\end{document}
